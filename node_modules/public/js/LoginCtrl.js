var app = angular.module('dikerApp', []);

app.controller('loginCtrl', function($scope,$http,$location ) {
    $scope.Login={};
    $scope.errmsg='a';

        $scope.registerNew=function(){
            $http({
                     method : "GET",
                     params:  {name : $scope.Login.name, email: $scope.Login.email, password: $scope.Login.password, type: $scope.Login.type },
                    url : "http://localhost:8080/setup"                      
                }).success(function(data, status, headers, config) {  
                            //   alert(JSON.stringify(data));
                               if(data.success==false){
                                   $scope.errmsg=data.error;
                               }
                                if(data.success==true){
                                  alert("Registration successfull. Please proceed with login");
                               }

                        }
                        ). error(function(data, status, headers, config) {
                           angular.fromJson(data);
                                 }
                         );
        }

        $scope.doLogin=function(){
            $http({
                     method : "POST",                
                    url : "http://localhost:8080/api/authenticate",
                     headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                                    transformRequest: function(obj) {
                                        var str = [];
                                        for(var p in obj)
                                        str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
                                        return str.join("&");
                                },                 
                     data:  {email: $scope.Login.email, password: $scope.Login.password},                  
                }).success(function(data, status, headers, config) {  
                               //alert(JSON.stringify(data));
                                  if(data.success==false){
                                    $scope.errmsg=data.message;
                               }if (data.success==true){
                                  // alert('redirecting');
                                   var navLink="";
                                        if(data.type=="V"){
                                           navLink="http://localhost:8080/agency_dash?token="+data.token; 
                                        }
                                        if(data.type=="C"){
                                           navLink="http://localhost:8080/comp_dash?token="+data.token; 
                                        }
                                   window.location=navLink;
                               }
                        }
                        ). error(function(data, status, headers, config) {
                                     $scope.errmsg=data.message;
                        }
                         );
        }




});